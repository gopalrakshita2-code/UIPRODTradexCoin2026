<p-toast />
<div class="grid grid-cols-12 gap-4 sm:gap-6 lg:gap-8">
    <div class="col-span-full lg:col-span-8 xl:col-span-6">
        <div class="card">
            <div class="font-semibold text-lg sm:text-xl mb-4 sm:mb-6">Upload Your ID for Verification</div>
            
            <!-- Warning Message -->
            <div class="mb-4 sm:mb-6 p-3 sm:p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg">
                <div class="flex items-start gap-2 sm:gap-3">
                    <i class="pi pi-exclamation-triangle text-amber-600 dark:text-amber-400 text-lg sm:text-xl mt-0.5 flex-shrink-0"></i>
                    <div class="flex-1 min-w-0">
                        <div class="font-semibold text-sm sm:text-base text-amber-900 dark:text-amber-200 mb-1">
                            Minimum Balance Required
                        </div>
                        <p class="text-xs sm:text-sm text-amber-800 dark:text-amber-300 leading-relaxed">
                            You need to maintain a minimum balance of $1,000 in your account to unlock the loan feature. Please ensure your account balance meets this requirement to access this service.
                        </p>
                    </div>
                </div>
            </div>
            
            <form class="flex flex-col gap-4 sm:gap-6" [class.opacity-60]="isFormDisabled">
                <!-- File Upload Section -->
                <div class="flex flex-col gap-2">
                    <label class="text-xs sm:text-sm font-medium text-surface-700 dark:text-surface-300 mb-1">
                        ID Document
                    </label>
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3">
                        <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
                            <p-fileupload 
                                #fileUpload
                                mode="basic" 
                                chooseLabel="Choose" 
                                chooseIcon="pi pi-upload" 
                                name="idDocument" 
                                url="https://www.primefaces.org/cdn/api/upload.php" 
                                accept="image/*,.pdf" 
                                maxFileSize="5000000" 
                                (onUpload)="onUpload($event)"
                                styleClass="flex-1 sm:flex-shrink-0"
                                [disabled]="isFormDisabled"
                            />
                            <span class="text-xs sm:text-sm text-surface-500 dark:text-surface-400 flex-shrink-0 sm:hidden" *ngIf="!fileUpload.files || fileUpload.files.length === 0">
                                No file chosen
                            </span>
                            <span class="text-xs sm:text-sm text-surface-700 dark:text-surface-300 flex-shrink-0 font-medium truncate max-w-[150px] sm:max-w-[200px]" *ngIf="fileUpload.files && fileUpload.files.length > 0" [title]="fileUpload.files[0].name">
                                {{ fileUpload.files[0].name }}
                            </span>
                        </div>
                        <div class="flex items-center gap-2 sm:gap-3 sm:flex-shrink-0">
                            <span class="text-xs sm:text-sm text-surface-500 dark:text-surface-400 hidden sm:inline" *ngIf="!fileUpload.files || fileUpload.files.length === 0">
                                No file chosen
                            </span>
                            <span class="text-xs sm:text-sm text-surface-700 dark:text-surface-300 hidden sm:inline font-medium truncate max-w-[150px] sm:max-w-[200px]" *ngIf="fileUpload.files && fileUpload.files.length > 0" [title]="fileUpload.files[0].name">
                                {{ fileUpload.files[0].name }}
                            </span>
                            <p-button 
                                label="Upload" 
                                (onClick)="fileUpload.upload()" 
                                severity="secondary"
                                [disabled]="isFormDisabled || !fileUpload.files || fileUpload.files.length === 0"
                                styleClass="w-full sm:w-auto flex-shrink-0"
                            />
                        </div>
                    </div>
                </div>

                <!-- Loan Amount -->
                <div class="flex flex-col gap-2">
                    <label for="loanAmount" class="text-xs sm:text-sm font-medium text-surface-700 dark:text-surface-300">
                        Loan Amount
                    </label>
                    <p-inputnumber 
                        id="loanAmount"
                        [(ngModel)]="loanAmount" 
                        name="loanAmount"
                        mode="decimal"
                        [min]="0"
                        [max]="1000000"
                        [useGrouping]="true"
                        placeholder="Enter loan amount"
                        fluid
                        [disabled]="isFormDisabled"
                        (onInput)="calculateInterest()"
                    />
                </div>

                <!-- Loan Term Dropdown -->
                <div class="flex flex-col gap-2">
                    <label for="loanTerm" class="text-xs sm:text-sm font-medium text-surface-700 dark:text-surface-300">
                        Loan Term (Days)
                    </label>
                    <p-select 
                        id="loanTerm"
                        [(ngModel)]="selectedLoanTerm" 
                        name="loanTerm"
                        [options]="loanTermOptions" 
                        optionLabel="label" 
                        optionValue="value" 
                        placeholder="Select loan term"
                        fluid
                        [disabled]="isFormDisabled"
                        (ngModelChange)="calculateInterest()"
                    />
                </div>

                <!-- Total Interest Information -->
                <div class="flex flex-col gap-3 p-3 sm:p-4 bg-surface-50 dark:bg-surface-800 rounded-lg border border-surface-200 dark:border-surface-700">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                        <span class="text-xs sm:text-sm text-surface-600 dark:text-surface-400">
                            Total Interest <span class="text-xs">(Daily Interest Rate: 0.33%)</span>
                        </span>
                        <span class="text-base sm:text-lg font-semibold text-primary">
                            {{ calculatedInterest | number:'1.2-2' }}
                        </span>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-2">
                    <p-button 
                        label="Submit Application" 
                        icon="pi pi-check"
                        severity="success"
                        (onClick)="submitLoanApplication()"
                        [disabled]="isFormDisabled || !isFormValid()"
                        styleClass="w-full"
                    />
                </div>
            </form>
        </div>
    </div>
</div>